<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Song Lyrics Viewer</title>
<style>
body { margin:0; font-family: Arial,sans-serif; background:#fafafa; }
header { background:#333;color:#fff;padding:15px;text-align:center;font-size:1.5rem; }
#container { display:flex;flex-direction:column;height:100vh; }
#menu { background:#444;color:#fff;padding:10px; }
#menu h3 { margin-top:0; cursor:pointer; }
#song-search { margin:10px 0; text-align:center; display:none; }
#song-table-container { display:none; max-height:250px; overflow-y:auto; background:#333; padding:10px; border-radius:5px; }
table { width:100%; border-collapse:collapse; color:#fff; font-size:0.9rem; }
th, td { padding:8px; border-bottom:1px solid #555; cursor:pointer; }
tr:hover td { background:#555; }
#lyrics-container { flex:1; overflow-y:auto; padding:20px; font-size:18px; line-height:1.5; background:#fff; white-space: pre-wrap; }
#controls { display:flex; justify-content:center; gap:10px; padding:10px; background:#333; flex-wrap:wrap; }
.btn { background:#00aaff; color:white; border:none; padding:6px 10px; border-radius:3px; font-size:10px; cursor:pointer; }
.btn:hover { background:#0088cc; }
footer { text-align:center; padding:10px; background:#222; }
footer a { color:#00aaff; text-decoration:none; }
#view-options { text-align:center; margin-bottom:5px; }
</style>
</head>
<body>
<div id="container">

  <!-- Lyrics/Chords Radio -->
  <div id="view-options">
    <label><input type="radio" name="viewType" value="lyrics" checked onchange="updateView()"> Lyrics</label>
    <label><input type="radio" name="viewType" value="chords" onchange="updateView()"> Chords</label>
  </div>

  <!-- Autoscroll / Font Controls -->
  <div id="controls">
    <button class="btn" onclick="startScroll()">Start</button>
    <button class="btn" onclick="stopScroll()">Stop</button>
    <button class="btn" onclick="increaseSpeed()">Faster</button>
    <button class="btn" onclick="decreaseSpeed()">Slower</button>
    <button class="btn" onclick="increaseFont()">A+</button>
    <button class="btn" onclick="decreaseFont()">A-</button>
  </div>

  <!-- Song Menu -->
  <div id="menu">
    <h3 onclick="toggleMenu()">Song List â–¼</h3>

    <!-- Search (initially hidden) -->
    <div id="song-search">
      <input type="text" id="search-input" placeholder="Search songs..." style="width:70%; padding:4px;" oninput="filterSongs()">
      <button class="btn" onclick="filterSongs()">Search</button>
    </div>

    <div id="song-table-container">
      <table id="song-table">
        <thead>
          <tr>
            <th onclick="sortTable(0,true)">SEQ</th>
            <th onclick="sortTable(1,false)">Song Title</th>
          </tr>
        </thead>
        <tbody id="song-tbody"></tbody>
      </table>
    </div>
  </div>

  <!-- Lyrics Display -->
  <div id="lyrics-container">Select a song from the menu to view lyrics.</div>

</div>

<footer>
  <a href="https://chasingembers937.com/bs/index.html" target="_blank">Back to Chasing Embers</a>
</footer>

<script>
let scrollInterval, scrollSpeed=200, fontSize=18;
let songs=[], currentSong=null;
let sortAsc={0:true,1:true};
let viewType='lyrics';

// Load songs JSON
fetch('songs.json')
  .then(res => res.json())
  .then(data => { songs=data; populateSongTable(); });

// Populate song table
function populateSongTable(filteredSongs = null){
  const tbody=document.getElementById('song-tbody');
  tbody.innerHTML='';
  const list = filteredSongs || songs;
  list.forEach((song,i)=>{
    const tr=document.createElement('tr');
    tr.innerHTML=`<td>${i+1}</td><td>${song.title}</td>`;
    tr.onclick=()=>loadSong(i);
    tbody.appendChild(tr);
  });
}

// Get filtered songs from search input
function filteredSongs(){
  const input = document.getElementById('search-input').value.toLowerCase();
  return songs.filter(song => song.title.toLowerCase().includes(input));
}

// Filter table based on search
function filterSongs(){
  populateSongTable(filteredSongs());
}

// Load selected song
function loadSong(index){
  // Choose from filtered list if search active
  const filtered = filteredSongs();
  currentSong = document.getElementById('search-input').value ? filtered[index] : songs[index];
  
  // Collapse menu and hide search
  document.getElementById('song-table-container').style.display = 'none';
  document.getElementById('song-search').style.display = 'none';
  
  // Fetch lyrics/chords
  fetch(currentSong.lyricsFile).then(r=>r.text()).then(text=>{currentSong.lyrics=text; updateView();});
  fetch(currentSong.chordsFile).then(r=>r.text()).then(text=>{currentSong.chords=text;});
}

// Update lyrics/chords view
function updateView(){
  const container=document.getElementById('lyrics-container');
  viewType=document.querySelector('input[name=viewType]:checked').value;
  if(!currentSong){ container.innerText='Select a song from the menu to view lyrics.'; return; }
  if(viewType==='lyrics' && currentSong.lyrics){
    container.innerText=currentSong.lyrics;
  } else if(viewType==='chords' && currentSong.chords){
    container.innerHTML=`<pre>${currentSong.chords}</pre>`;
  } else { container.innerText='Loading...'; }
  container.scrollTop=0;
}

// Autoscroll / Font
function startScroll(){stopScroll(); scrollInterval=setInterval(()=>document.getElementById('lyrics-container').scrollTop+=1,scrollSpeed);}
function stopScroll(){clearInterval(scrollInterval);}
function increaseSpeed(){if(scrollSpeed>10)scrollSpeed-=10;startScroll();}
function decreaseSpeed(){scrollSpeed+=10;startScroll();}
function increaseFont(){fontSize+=2; document.getElementById('lyrics-container').style.fontSize=fontSize+'px';}
function decreaseFont(){fontSize=Math.max(10,fontSize-2); document.getElementById('lyrics-container').style.fontSize=fontSize+'px';}

// Menu toggle
function toggleMenu(){
  const box=document.getElementById('song-table-container');
  const search=document.getElementById('song-search');
  const isHidden = box.style.display==='none';
  box.style.display = isHidden ? 'block' : 'none';
  search.style.display = isHidden ? 'block' : 'none';
}

// Table sorting
function sortTable(colIndex,isNumber){
  const tbody=document.getElementById('song-tbody');
  const rows=Array.from(tbody.querySelectorAll('tr'));
  const asc=sortAsc[colIndex];
  rows.sort((a,b)=>{
    const A=a.children[colIndex].innerText; const B=b.children[colIndex].innerText;
    if(isNumber) return asc?Number(A)-Number(B):Number(B)-Number(A);
    return asc?A.localeCompare(B):B.localeCompare(A);
  });
  rows.forEach(r=>tbody.appendChild(r));
  sortAsc[colIndex]=!asc;
}
</script>
</body>
</html>
