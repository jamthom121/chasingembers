<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Song Lyrics Viewer</title>
<style>
body { margin:0; font-family: Arial,sans-serif; background:#fafafa; }
#container { display:flex;flex-direction:column;height:100vh; }
#audio-container { text-align:center; padding:10px; background:#222; color:white; display:flex; justify-content:center; align-items:center; gap:10px; }
#audio-status { font-weight:bold; }
#menu { background:#444;color:#fff;padding:10px; display:flex; flex-direction:column; gap:5px; }
#menu-header { display:flex; justify-content:space-between; align-items:center; }
#menu-header h3 { margin:0; cursor:pointer; }
#prev-next { display:flex; gap:5px; }
#song-search { text-align:center; display:none; margin-top:5px; }
#song-table-container { display:none; max-height:250px; overflow-y:auto; background:#333; padding:10px; border-radius:5px; margin-top:5px; }
table { width:100%; border-collapse:collapse; color:#fff; font-size:0.9rem; }
th, td { padding:8px; border-bottom:1px solid #555; cursor:pointer; }
tr:hover td { background:#555; }
tr.current { background:#0088cc !important; }
#lyrics-container { flex:1; overflow-y:auto; padding:20px; font-size:18px; line-height:1.5; background:#fff; white-space: pre-wrap; }
#controls { display:flex; justify-content:center; gap:10px; padding:10px; background:#333; flex-wrap:wrap; }
.btn { background:#00aaff; color:white; border:none; padding:2px 10px; border-radius:4px; font-size:10px; cursor:pointer; }
.btn:hover { background:#0088cc; }
footer { text-align:center; padding:10px; background:#222; }
footer a { color:#00aaff; text-decoration:none; }
#view-options { text-align:center; margin-bottom:5px; }
</style>
</head>
<body>
<div id="container">

  <!-- Audio Player -->
  <div id="audio-container">
    <audio id="audio-player" controls></audio>
    <span id="audio-status">No song loaded</span>
  </div>

  <!-- Lyrics/Chords Radio -->
  <div id="view-options">
    <label><input type="radio" name="viewType" value="lyrics" checked onchange="updateView()"> Lyrics</label>
    <label><input type="radio" name="viewType" value="chords" onchange="updateView()"> Chords</label>
  </div>

  <!-- Autoscroll / Font Controls -->
  <div id="controls">
    <button class="btn" onclick="startScroll()">Start</button>
    <button class="btn" onclick="stopScroll()">Stop</button>
    <button class="btn" onclick="increaseSpeed()">Faster</button>
    <button class="btn" onclick="decreaseSpeed()">Slower</button>
    <button class="btn" onclick="increaseFont()">A+</button>
    <button class="btn" onclick="decreaseFont()">A-</button>
  </div>

  <!-- Song Menu -->
  <div id="menu">
    <!-- Level 1 -->
    <div id="menu-header">
      <h3 onclick="toggleMenu()">Song List ▼</h3>
      <div id="prev-next">
        <button class="btn" onclick="prevSong()">Prev</button>
        <button class="btn" onclick="nextSong()">Next</button>
      </div>
    </div>

    <!-- Level 2: Search -->
    <div id="song-search">
      <input type="text" id="search-input" placeholder="Search songs..." style="width:70%; padding:4px;" oninput="filterSongs()">
      <button class="btn" onclick="filterSongs()">Search</button>
    </div>

    <!-- Level 3: Song Table -->
    <div id="song-table-container">
      <table id="song-table">
        <thead>
          <tr>
            <th onclick="sortTable(0,true)">SEQ</th>
            <th onclick="sortTable(1,false)">Song Title</th>
            <th onclick="sortTable(2,false)">Artist</th>
          </tr>
        </thead>
        <tbody id="song-tbody"></tbody>
      </table>
    </div>
  </div>

  <!-- Lyrics Display -->
  <div id="lyrics-container">Select a song from the menu to view lyrics.</div>

</div>

<footer>
  <a href="https://chasingembers937.com/bs/index.html" target="_blank">Back to Chasing Embers</a>
</footer>

<script>
let scrollInterval, scrollSpeed = 130, fontSize = 18;
let songs = [], currentSongIndex = 0;
let sortAsc = {0:true, 1:true, 2:true};
let viewType = 'lyrics';

const audioPlayer = document.getElementById('audio-player');
const audioStatus = document.getElementById('audio-status');

// Load songs JSON
fetch('songs.json')
  .then(res => res.json())
  .then(data => {
    songs = data.sort((a,b) => a.seq - b.seq);
    populateSongTable();
    loadSong(0);
  });

// Populate song table
function populateSongTable(filteredSongs = null){
  const tbody = document.getElementById('song-tbody');
  tbody.innerHTML = '';
  const list = filteredSongs || songs;

  list.forEach((song) => {
    const tr = document.createElement('tr');
    const realIndex = songs.indexOf(song);
    tr.dataset.index = realIndex;
    tr.onclick = () => loadSong(realIndex);

    tr.innerHTML = `
      <td>${song.seq}</td>
      <td>${song.title}</td>
      <td>${song.artist}</td>
    `;

    tbody.appendChild(tr);
  });

  highlightCurrentSong();
}

// Highlight current song and scroll into view
function highlightCurrentSong(){
  const tbody = document.getElementById('song-tbody');
  Array.from(tbody.querySelectorAll('tr')).forEach(row => row.classList.remove('current'));
  const currentRow = tbody.querySelector(`tr[data-index="${currentSongIndex}"]`);
  if(currentRow){
    currentRow.classList.add('current');
    currentRow.scrollIntoView({behavior:'smooth', block:'center'});
  }
}

// Filter songs
function filteredSongs(){
  const input = document.getElementById('search-input').value.toLowerCase();
  return songs.filter(song => 
    song.title.toLowerCase().includes(input) || 
    song.artist.toLowerCase().includes(input)
  );
}

function filterSongs(){
  populateSongTable(filteredSongs());
}

// Load song
function loadSong(index){
  if(index < 0 || index >= songs.length) return;
  currentSongIndex = index;
  const song = songs[index];

  // Collapse menu
  document.getElementById('song-table-container').style.display = 'none';
  document.getElementById('song-search').style.display = 'none';

  // Load lyrics and chords
  fetch(song.lyricsfile).then(r => r.text()).then(text => {
    song.lyrics = text; updateView();
  });
  fetch(song.chordsfile).then(r => r.text()).then(text => {
    song.chords = text;
  });

  // Load audio
  if(song.backingtrack){
    audioPlayer.src = song.backingtrack;
    audioPlayer.load();
    audioPlayer.oncanplay = () => { audioStatus.innerText = 'Audio loaded ✅'; audioStatus.style.color = 'lime'; };
    audioPlayer.onerror = () => { audioStatus.innerText = 'Audio failed ❌'; audioStatus.style.color = 'red'; };
  } else {
    audioPlayer.src = '';
    audioStatus.innerText = 'No audio file ❌';
    audioStatus.style.color = 'red';
  }

  highlightCurrentSong();
}

// Previous / Next song
function prevSong(){ 
  const newIndex = (currentSongIndex - 1 + songs.length) % songs.length;
  loadSong(newIndex);
}
function nextSong(){ 
  const newIndex = (currentSongIndex + 1) % songs.length;
  loadSong(newIndex);
}

// Update lyrics/chords view
function updateView(){
  const container = document.getElementById('lyrics-container');
  viewType = document.querySelector('input[name=viewType]:checked').value;
  const song = songs[currentSongIndex];
  if(!song){ 
    container.innerText = 'Select a song from the menu to view lyrics.'; 
    return; 
  }
  if(viewType === 'lyrics' && song.lyrics){
    container.innerText = song.lyrics;
  } else if(viewType === 'chords' && song.chords){
    container.innerHTML = `<pre>${song.chords}</pre>`;
  } else {
    container.innerText = 'Loading...';
  }
  container.scrollTop = 0;
}

// Autoscroll / Font
function startScroll(){stopScroll(); scrollInterval=setInterval(()=>document.getElementById('lyrics-container').scrollTop+=1, scrollSpeed);}
function stopScroll(){clearInterval(scrollInterval);}
function increaseSpeed(){if(scrollSpeed>10) scrollSpeed-=10; startScroll();}
function decreaseSpeed(){scrollSpeed+=10; startScroll();}
function increaseFont(){fontSize+=2; document.getElementById('lyrics-container').style.fontSize=fontSize+'px';}
function decreaseFont(){fontSize=Math.max(10,fontSize-2); document.getElementById('lyrics-container').style.fontSize=fontSize+'px';}

// Menu toggle
function toggleMenu(){
  const box = document.getElementById('song-table-container');
  const search = document.getElementById('song-search');
  const isHidden = box.style.display === 'none';
  box.style.display = isHidden ? 'block' : 'none';
  search.style.display = isHidden ? 'block' : 'none';
}

// Table sorting
function sortTable(colIndex, isNumber){
  const tbody = document.getElementById('song-tbody');
  const rows = Array.from(tbody.querySelectorAll('tr'));
  const asc = sortAsc[colIndex];
  rows.sort((a,b) => {
    const A = a.children[colIndex].innerText;
    const B = b.children[colIndex].innerText;
    if(isNumber) return asc ? Number(A)-Number(B) : Number(B)-Number(A);
    return asc ? A.localeCompare(B) : B.localeCompare(A);
  });
  rows.forEach(r => tbody.appendChild(r));
  sortAsc[colIndex] = !asc;
  highlightCurrentSong();
}
</script>
</body>
</html>
