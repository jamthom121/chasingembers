<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Song Lyrics Viewer</title>

<style>
    body {
        margin: 0;
        font-family: Arial, sans-serif;
        background: #f5f5f5;
    }

    /* Header / Controls */
    #header {
        background: #333;
        color: white;
        padding: 12px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    #songListHeader {
        display: flex;
        align-items: center;
        gap: 10px;
        cursor: pointer;
        font-size: 18px;
    }

    #controls button {
        padding: 6px 12px;
        margin-left: 6px;
        border: none;
        border-radius: 4px;
        background: #555;
        color: white;
        cursor: pointer;
    }

    #controls button:hover {
        background: #777;
    }

    /* Search Area */
    #search-area {
        display: none;
        background: #ddd;
        padding: 10px;
        border-bottom: 1px solid #ccc;
    }

    #search-area input {
        padding: 6px;
        width: 200px;
    }

    /* Song List Table */
    #song-table-container {
        display: none;
        max-height: 320px;
        overflow-y: auto;
        background: white;
        border-bottom: 1px solid #ccc;
    }

    table {
        width: 100%;
        border-collapse: collapse;
    }

    th {
        background: #efefef;
        cursor: pointer;
        padding: 8px;
        border-bottom: 1px solid #ccc;
    }

    td {
        padding: 8px;
        border-bottom: 1px solid #eee;
    }

    tr.highlight {
        background: #c2e7ff !important;
        font-weight: bold;
    }

    /* Lyrics */
    #lyrics-container {
        padding: 20px;
        white-space: pre-wrap;
        font-size: 18px;
    }
</style>
</head>

<body>

<!-- Header -->
<div id="header">
    <div id="songListHeader">
        <span id="songListLabel">Song List â–¼</span>
    </div>

    <div id="controls">
        <button id="prevBtn">Prev</button>
        <button id="nextBtn">Next</button>
    </div>
</div>

<!-- Search Area -->
<div id="search-area">
    <input id="searchInput" type="text" placeholder="Search title or artist...">
    <button id="searchBtn">Search</button>
</div>

<!-- Song Table -->
<div id="song-table-container">
    <table>
        <thead>
            <tr>
                <th data-col="0">#</th>
                <th data-col="1">Title</th>
                <th data-col="2">Artist</th>
            </tr>
        </thead>
        <tbody id="song-tbody"></tbody>
    </table>
</div>

<!-- Lyrics Display -->
<div id="lyrics-container">Select a song from the menu to view lyrics.</div>

<!-- Audio -->
<audio id="audioPlayer" controls style="width:100%; margin-top:10px;"></audio>

<script>
let songs = [];
let currentSongIndex = 0;

/* ---------------------------
   INITIAL LOAD
---------------------------- */
document.addEventListener("DOMContentLoaded", () => {
    fetch("songs.json")
        .then(res => res.json())
        .then(data => {
            songs = data.sort((a, b) => a.seq - b.seq);
            populateSongTable();

            // Load FIRST song on page load
            loadSong(0);
        });
});

/* ---------------------------
   POPULATE SONG TABLE
---------------------------- */
function populateSongTable(filtered = null) {
    const tbody = document.getElementById("song-tbody");
    tbody.innerHTML = "";

    const list = filtered || songs;

    list.forEach(song => {
        const tr = document.createElement("tr");

        // Real index so clicking a search result loads correct item
        const realIndex = songs.indexOf(song);

        tr.dataset.index = realIndex;
        tr.onclick = () => loadSong(realIndex);

        // FIX: Insert table cells
        tr.innerHTML = `
            <td>${song.seq}</td>
            <td>${song.title}</td>
            <td>${song.artist}</td>
        `;

        tbody.appendChild(tr);
    });

    highlightCurrentSong();
}

/* ---------------------------
   LOAD SONG
---------------------------- */
function loadSong(index) {
    currentSongIndex = index;

    const song = songs[index];

    // Load lyrics
    fetch(song.lyrics)
        .then(res => res.text())
        .then(text => {
            document.getElementById("lyrics-container").innerText = text;
        });

    // Load audio if available
    const audio = document.getElementById("audioPlayer");
    if (song.audio) {
        audio.src = song.audio;
        audio.style.display = "block";
    } else {
        audio.style.display = "none";
    }

    highlightCurrentSong();

    // Hide search area after selecting
    document.getElementById("search-area").style.display = "none";
}

/* ---------------------------
   HIGHLIGHT CURRENT & SCROLL
---------------------------- */
function highlightCurrentSong() {
    const rows = document.querySelectorAll("#song-tbody tr");
    rows.forEach(r => r.classList.remove("highlight"));

    const active = [...rows].find(r => Number(r.dataset.index) === currentSongIndex);
    if (active) {
        active.classList.add("highlight");
        active.scrollIntoView({ block: "center", behavior: "smooth" });
    }
}

/* ---------------------------
   PREV / NEXT
---------------------------- */
document.getElementById("prevBtn").onclick = () => {
    if (currentSongIndex > 0) loadSong(currentSongIndex - 1);
};

document.getElementById("nextBtn").onclick = () => {
    if (currentSongIndex < songs.length - 1) loadSong(currentSongIndex + 1);
};

/* ---------------------------
   SONG LIST DROPDOWN
---------------------------- */
document.getElementById("songListHeader").onclick = () => {
    const list = document.getElementById("song-table-container");
    const search = document.getElementById("search-area");

    const isOpen = list.style.display === "block";

    list.style.display = isOpen ? "none" : "block";
    search.style.display = isOpen ? "none" : "block";
};

/* ---------------------------
   SEARCH FUNCTION
---------------------------- */
document.getElementById("searchBtn").onclick = () => {
    const val = document.getElementById("searchInput").value.toLowerCase();

    const filtered = songs.filter(s =>
        s.title.toLowerCase().includes(val) ||
        s.artist.toLowerCase().includes(val)
    );

    populateSongTable(filtered);
};

/* ---------------------------
   SORT COLUMNS
---------------------------- */
document.querySelectorAll("th").forEach(th => {
    th.addEventListener("click", () => {
        const col = th.dataset.col;
        const tbody = document.getElementById("song-tbody");
        const rows = Array.from(tbody.querySelectorAll("tr"));

        const sorted = rows.sort((a, b) => {
            const aVal = a.children[col].innerText;
            const bVal = b.children[col].innerText;
            return aVal.localeCompare(bVal, undefined, { numeric: true });
        });

        tbody.innerHTML = "";
        sorted.forEach(r => tbody.appendChild(r));
    });
});
</script>

</body>
</html>
